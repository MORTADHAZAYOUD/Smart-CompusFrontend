<div class="dashboard-container">
  <!-- Loading Spinner -->
  <div class="loading-container" *ngIf="loading">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Loading dashboard...</p>
  </div>

  <!-- Dashboard Content -->
  <div class="dashboard-content" *ngIf="!loading && stats">
    <!-- Welcome Section -->
    <div class="welcome-section">
      <h1>Welcome back, {{ stats.nextSession?.teacher?.split(' ')[0] || 'Student' }}!</h1>
      <p class="subtitle">Here's your academic overview for today</p>
    </div>

    <!-- Stats Cards Row -->
    <div class="stats-row">
      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-header">
            <mat-icon class="stat-icon">school</mat-icon>
            <span class="stat-label">Global Average</span>
          </div>
          <div class="stat-value" [style.color]="getGradeColor(stats.globalAverage)">
            {{ stats.globalAverage }}%
          </div>
          <div class="stat-description">Your overall performance</div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-header">
            <mat-icon class="stat-icon">event_available</mat-icon>
            <span class="stat-label">Attendance Rate</span>
          </div>
          <div class="stat-value" [style.color]="getAttendanceColor(stats.attendanceRate)">
            {{ stats.attendanceRate }}%
          </div>
          <div class="stat-description">This semester</div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-header">
            <mat-icon class="stat-icon">schedule</mat-icon>
            <span class="stat-label">Upcoming Sessions</span>
          </div>
          <div class="stat-value">{{ stats.upcomingSessions }}</div>
          <div class="stat-description">Next 7 days</div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-header">
            <mat-icon class="stat-icon">notifications</mat-icon>
            <span class="stat-label">Unread Messages</span>
          </div>
          <div class="stat-value">{{ stats.unreadMessages }}</div>
          <div class="stat-description">New messages</div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Charts and Next Session Row -->
    <div class="charts-row">
      <!-- Performance Chart -->
      <mat-card class="chart-card">
        <mat-card-header>
          <mat-card-title>Performance by Subject</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="chart-container" *ngIf="!chartLoading; else chartSpinner">
            <ngx-charts-bar-vertical
              [results]="performanceChartData"
              [xAxis]="performanceChartOptions.showXAxis"
              [yAxis]="performanceChartOptions.showYAxis"
              [gradient]="performanceChartOptions.gradient"
              [legend]="performanceChartOptions.showLegend"
              [xAxisLabel]="performanceChartOptions.xAxisLabel"
              [yAxisLabel]="performanceChartOptions.yAxisLabel"
              [scheme]="performanceChartOptions.colorScheme"
              (select)="onChartClick($event)">
            </ngx-charts-bar-vertical>
          </div>
          <ng-template #chartSpinner>
            <div class="chart-loading">
              <mat-spinner diameter="30"></mat-spinner>
              <p>Loading chart...</p>
            </div>
          </ng-template>
        </mat-card-content>
      </mat-card>

      <!-- Attendance Chart -->
      <mat-card class="chart-card">
        <mat-card-header>
          <mat-card-title>Attendance Overview</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="chart-container">
            <ngx-charts-pie-chart
              [results]="attendanceChartData"
              [gradient]="attendanceChartOptions.gradient"
              [legend]="attendanceChartOptions.showLegend"
              [labels]="attendanceChartOptions.showLabels"
              [doughnut]="attendanceChartOptions.isDoughnut"
              [scheme]="attendanceChartOptions.colorScheme"
              (select)="onChartClick($event)">
            </ngx-charts-pie-chart>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Next Session -->
      <mat-card class="next-session-card" *ngIf="stats.nextSession">
        <mat-card-header>
          <mat-card-title>Next Session</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="session-info">
            <div class="session-subject">{{ stats.nextSession.subject }}</div>
            <div class="session-details">
              <div class="session-time">
                <mat-icon>schedule</mat-icon>
                {{ formatTime(stats.nextSession.startTime) }} - {{ formatTime(stats.nextSession.endTime) }}
              </div>
              <div class="session-teacher">
                <mat-icon>person</mat-icon>
                {{ stats.nextSession.teacher }}
              </div>
              <div class="session-room">
                <mat-icon>room</mat-icon>
                {{ stats.nextSession.room }}
              </div>
            </div>
            <div class="session-status" [style.background-color]="getSessionStatusColor(stats.nextSession.status)">
              {{ stats.nextSession.status | titlecase }}
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Recent Activities Row -->
    <div class="activities-row">
      <!-- Recent Notes -->
      <mat-card class="activity-card">
        <mat-card-header>
          <mat-card-title>Recent Grades</mat-card-title>
          <button mat-button routerLink="/student/notes">View All</button>
        </mat-card-header>
        <mat-card-content>
          <div class="activity-list">
            <div class="activity-item" *ngFor="let note of stats.recentNotes">
              <div class="activity-icon">
                <mat-icon [style.color]="getGradeColor(note.note)">school</mat-icon>
              </div>
              <div class="activity-content">
                <div class="activity-title">{{ note.subject }}</div>
                <div class="activity-subtitle">{{ note.type | titlecase }} - {{ note.teacher }}</div>
                <div class="activity-meta">{{ note.date | date:'shortDate' }}</div>
              </div>
              <div class="activity-value" [style.color]="getGradeColor(note.note)">
                {{ note.note }}/{{ note.maxNote }}
              </div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Recent Notifications -->
      <mat-card class="activity-card">
        <mat-card-header>
          <mat-card-title>Recent Notifications</mat-card-title>
          <button mat-button routerLink="/student/notifications">View All</button>
        </mat-card-header>
        <mat-card-content>
          <div class="activity-list">
            <div class="activity-item" *ngFor="let notification of stats.recentNotifications">
              <div class="activity-icon">
                <mat-icon [style.color]="getNotificationColor(notification.type)">
                  {{ getNotificationIcon(notification.type) }}
                </mat-icon>
              </div>
              <div class="activity-content">
                <div class="activity-title">{{ notification.title }}</div>
                <div class="activity-subtitle">{{ notification.message }}</div>
                <div class="activity-meta">{{ notification.date | date:'short' }}</div>
              </div>
              <div class="activity-status" *ngIf="!notification.isRead">
                <div class="unread-indicator"></div>
              </div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
      <h3>Quick Actions</h3>
      <div class="actions-grid">
        <button mat-raised-button color="primary" routerLink="/student/notes">
          <mat-icon>school</mat-icon>
          View Grades
        </button>
        <button mat-raised-button color="accent" routerLink="/student/schedule">
          <mat-icon>calendar_today</mat-icon>
          My Schedule
        </button>
        <button mat-raised-button color="warn" routerLink="/student/messages">
          <mat-icon>message</mat-icon>
          Messages
        </button>
        <button mat-raised-button routerLink="/student/events">
          <mat-icon>event</mat-icon>
          School Events
        </button>
      </div>
    </div>
  </div>
</div>