<div class="profile-container" *ngIf="currentStudent$ | async as student">
  <div class="profile-header">
    <h2>My Profile</h2>
    <div class="header-actions">
      <button mat-raised-button 
              *ngIf="!isEditing" 
              color="primary" 
              (click)="toggleEdit()">
        Edit Profile
      </button>
      <button mat-button 
              *ngIf="isEditing" 
              (click)="toggleEdit()">
        Cancel
      </button>
    </div>
  </div>

  <div class="profile-content">
    <!-- Profile Picture Section -->
    <mat-card class="profile-picture-card">
      <mat-card-content>
        <div class="profile-picture-section">
          <div class="profile-picture">
            <img [src]="student.profilePicture" 
                 [alt]="student.firstName + ' ' + student.lastName" />
          </div>
          <div class="profile-picture-info">
            <h3>{{student.firstName}} {{student.lastName}}</h3>
            <p class="student-id">Student ID: {{student.studentId}}</p>
            <p class="program">{{student.program}} - Year {{student.year}}</p>
            <button mat-button color="primary" *ngIf="isEditing">
              Change Photo
            </button>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Personal Information Section -->
    <mat-card class="personal-info-card">
      <mat-card-header>
        <mat-card-title>
          Personal Information
        </mat-card-title>
      </mat-card-header>
      
      <mat-card-content>
        <form [formGroup]="profileForm" (ngSubmit)="onSubmit()" *ngIf="isEditing; else viewMode">
          <div class="form-grid">
            <mat-form-field appearance="outline">
              <mat-label>First Name</mat-label>
              <input matInput formControlName="firstName" />
              <mat-error>{{getErrorMessage('firstName')}}</mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Last Name</mat-label>
              <input matInput formControlName="lastName" />
              <mat-error>{{getErrorMessage('lastName')}}</mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Email</mat-label>
              <input matInput type="email" formControlName="email" />
              <mat-error>{{getErrorMessage('email')}}</mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Phone</mat-label>
              <input matInput formControlName="phone" />
              <mat-error>{{getErrorMessage('phone')}}</mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Date of Birth</mat-label>
              <input matInput 
                     [matDatepicker]="picker" 
                     formControlName="dateOfBirth" 
                     readonly />
              <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-datepicker #picker></mat-datepicker>
              <mat-error>{{getErrorMessage('dateOfBirth')}}</mat-error>
            </mat-form-field>
          </div>

          <div class="form-actions">
            <button mat-raised-button 
                    color="primary" 
                    type="submit" 
                    [disabled]="profileForm.invalid || isLoading">
              <mat-icon *ngIf="isLoading">hourglass_empty</mat-icon>
              {{isLoading ? 'Saving...' : 'Save Changes'}}
            </button>
          </div>
        </form>

        <ng-template #viewMode>
          <div class="info-grid">
            <div class="info-item">
              <div class="info-content">
                <label>Full Name</label>
                <span>{{student.firstName}} {{student.lastName}}</span>
              </div>
            </div>

            <div class="info-item">
              <div class="info-content">
                <label>Email</label>
                <span>{{student.email}}</span>
              </div>
            </div>

            <div class="info-item">
              <div class="info-content">
                <label>Phone</label>
                <span>{{student.phone}}</span>
              </div>
            </div>

            <div class="info-item">
              <div class="info-content">
                <label>Date of Birth</label>
                <span>{{formatDate(student.dateOfBirth)}} ({{calculateAge(student.dateOfBirth)}} years old)</span>
              </div>
            </div>

            <div class="info-item">
              <div class="info-content">
                <label>Student ID</label>
                <span>{{student.studentId}}</span>
              </div>
            </div>

            <div class="info-item">
              <div class="info-content">
                <label>Program</label>
                <span>{{student.program}}</span>
              </div>
            </div>

            <div class="info-item">
              <div class="info-content">
                <label>Academic Year</label>
                <span>Year {{student.year}}, Semester {{student.semester}}</span>
              </div>
            </div>
          </div>
        </ng-template>
      </mat-card-content>
    </mat-card>
  </div>
</div>