<div class="children-management">
  <!-- Page Header -->
  <div class="page-header">
    <h1>ğŸ‘¶ Gestion de mes enfants</h1>
    <p>GÃ©rez les comptes de vos enfants et consultez leurs informations acadÃ©miques</p>
  </div>

  <!-- Success/Error Messages -->
  <div class="alert alert-success" *ngIf="successMessage">
    âœ… {{ successMessage }}
    <button class="close-btn" (click)="clearMessages()">Ã—</button>
  </div>

  <div class="alert alert-error" *ngIf="errorMessage">
    âŒ {{ errorMessage }}
    <button class="close-btn" (click)="clearMessages()">Ã—</button>
  </div>

  <!-- Search and Actions -->
  <div class="search-section">
    <div class="search-bar">
      <input 
        type="text" 
        placeholder="ğŸ” Rechercher un enfant..."
        [(ngModel)]="searchQuery"
        class="search-input">
    </div>
    <button class="btn btn-primary" (click)="openLinkChildModal()">
      <span class="icon">â•</span>
      Lier un nouvel enfant
    </button>
  </div>

  <!-- Children Grid -->
  <div class="children-grid">
    <div class="child-card" *ngFor="let child of filteredChildren">
      <div class="child-header">
        <div class="child-avatar">
          <span class="avatar-icon">ğŸ‘¤</span>
        </div>
        <div class="child-basic-info">
          <h3 class="child-name">{{ child.name }}</h3>
          <p class="child-details">{{ child.class }} â€¢ {{ calculateAge(child.dateOfBirth) }} ans</p>
          <p class="student-id">ID: {{ child.studentId }}</p>
        </div>
        <div class="child-status">
          <span 
            class="status-badge"
            [style.background-color]="getStatusColor(child.status)">
            {{ getStatusText(child.status) }}
          </span>
        </div>
      </div>

      <div class="child-metrics">
        <div class="metric">
          <div class="metric-icon">ğŸ“š</div>
          <div class="metric-value" [style.color]="getGradeColor(child.averageGrade)">
            {{ child.averageGrade }}/20
          </div>
          <div class="metric-label">Moyenne</div>
        </div>
        <div class="metric">
          <div class="metric-icon">ğŸ“…</div>
          <div class="metric-value">{{ child.attendance }}%</div>
          <div class="metric-label">AssiduitÃ©</div>
        </div>
        <div class="metric">
          <div class="metric-icon">â­</div>
          <div class="metric-value" [style.color]="getBehaviorColor(child.behaviorRating)">
            {{ child.behaviorRating }}
          </div>
          <div class="metric-label">Comportement</div>
        </div>
      </div>

      <div class="child-actions">
        <button class="btn btn-outline" (click)="openChildDetail(child)">
          ğŸ‘ï¸ Voir dÃ©tails
        </button>
        <button class="btn btn-danger" (click)="unlinkChild(child)">
          ğŸ”— Dissocier
        </button>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="filteredChildren.length === 0">
    <div class="empty-icon">ğŸ‘¶</div>
    <h3>Aucun enfant trouvÃ©</h3>
    <p *ngIf="searchQuery">Aucun enfant ne correspond Ã  votre recherche.</p>
    <p *ngIf="!searchQuery">Vous n'avez pas encore liÃ© d'enfant Ã  votre compte.</p>
    <button class="btn btn-primary" (click)="openLinkChildModal()">
      â• Lier un enfant
    </button>
  </div>
</div>

<!-- Link Child Modal -->
<div class="modal-overlay" *ngIf="showLinkChildModal" (click)="closeLinkChildModal()">
  <div class="modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>â• Lier un nouvel enfant</h2>
      <button class="close-btn" (click)="closeLinkChildModal()">Ã—</button>
    </div>

    <div class="modal-body">
      <div class="form-group">
        <label for="studentId">ID Ã‰tudiant *</label>
        <input 
          type="text" 
          id="studentId"
          [(ngModel)]="linkChildRequest.studentId"
          placeholder="Ex: STU2024001"
          class="form-control">
      </div>

      <div class="form-group">
        <label for="studentName">Nom de l'enfant *</label>
        <input 
          type="text" 
          id="studentName"
          [(ngModel)]="linkChildRequest.studentName"
          placeholder="Nom complet de l'enfant"
          class="form-control">
      </div>

      <div class="form-group">
        <label for="verificationCode">Code de vÃ©rification (optionnel)</label>
        <input 
          type="text" 
          id="verificationCode"
          [(ngModel)]="linkChildRequest.verificationCode"
          placeholder="Code fourni par l'Ã©tablissement"
          class="form-control">
      </div>

      <div class="info-note">
        <p><strong>â„¹ï¸ Note:</strong> L'enfant doit Ãªtre prÃ©alablement inscrit dans le systÃ¨me pour pouvoir Ãªtre liÃ© Ã  votre compte parent.</p>
      </div>

      <div class="alert alert-error" *ngIf="errorMessage">
        {{ errorMessage }}
      </div>

      <div class="alert alert-success" *ngIf="successMessage">
        {{ successMessage }}
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeLinkChildModal()" [disabled]="isLoading">
        Annuler
      </button>
      <button class="btn btn-primary" (click)="linkNewChild()" [disabled]="isLoading">
        <span *ngIf="isLoading">â³ Liaison en cours...</span>
        <span *ngIf="!isLoading">âœ… Lier l'enfant</span>
      </button>
    </div>
  </div>
</div>

<!-- Child Detail Modal -->
<div class="modal-overlay" *ngIf="showChildDetailModal" (click)="closeChildDetail()">
  <div class="modal modal-large" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>ğŸ‘¤ {{ selectedChild?.name }}</h2>
      <button class="close-btn" (click)="closeChildDetail()">Ã—</button>
    </div>

    <div class="modal-body" *ngIf="selectedChild">
      <div class="detail-grid">
        <!-- Basic Information -->
        <div class="detail-section">
          <h3>ğŸ“‹ Informations gÃ©nÃ©rales</h3>
          <div class="info-grid">
            <div class="info-item">
              <label>Nom complet</label>
              <span>{{ selectedChild.name }}</span>
            </div>
            <div class="info-item">
              <label>Classe</label>
              <span>{{ selectedChild.class }}</span>
            </div>
            <div class="info-item">
              <label>Ã‚ge</label>
              <span>{{ calculateAge(selectedChild.dateOfBirth) }} ans</span>
            </div>
            <div class="info-item">
              <label>ID Ã‰tudiant</label>
              <span>{{ selectedChild.studentId }}</span>
            </div>
            <div class="info-item">
              <label>Date de liaison</label>
              <span>{{ formatDate(selectedChild.linkedDate) }}</span>
            </div>
            <div class="info-item">
              <label>Contact d'urgence</label>
              <input 
                type="text" 
                [value]="selectedChild.emergencyContact || ''"
                (blur)="updateEmergencyContact(selectedChild, $event.target.value)"
                placeholder="NumÃ©ro de tÃ©lÃ©phone"
                class="editable-field">
            </div>
          </div>
        </div>

        <!-- Academic Performance -->
        <div class="detail-section">
          <h3>ğŸ“š Performance acadÃ©mique</h3>
          <div class="subjects-list">
            <div class="subject-item" *ngFor="let subject of selectedChild.subjects">
              <div class="subject-header">
                <span class="subject-name">{{ subject.name }}</span>
                <span class="subject-teacher">{{ subject.teacher }}</span>
              </div>
              <div class="subject-metrics">
                <div class="subject-metric">
                  <span class="metric-label">Note</span>
                  <span class="metric-value" [style.color]="getGradeColor(subject.currentGrade)">
                    {{ subject.currentGrade }}/20
                  </span>
                </div>
                <div class="subject-metric">
                  <span class="metric-label">AssiduitÃ©</span>
                  <span class="metric-value">{{ subject.attendance }}%</span>
                </div>
                <div class="subject-metric">
                  <span class="metric-label">DerniÃ¨re activitÃ©</span>
                  <span class="metric-value">{{ formatDate(subject.lastActivity) }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Teachers -->
        <div class="detail-section">
          <h3>ğŸ‘¨â€ğŸ« Ã‰quipe pÃ©dagogique</h3>
          <div class="teachers-list">
            <div class="teacher-item" *ngFor="let teacher of selectedChild.teachers">
              <div class="teacher-info">
                <div class="teacher-name">{{ teacher.name }}</div>
                <div class="teacher-subject">{{ teacher.subject }}</div>
                <div class="teacher-contact">
                  <span *ngIf="teacher.email">ğŸ“§ {{ teacher.email }}</span>
                  <span *ngIf="teacher.phone">ğŸ“ {{ teacher.phone }}</span>
                </div>
              </div>
              <button class="btn btn-sm btn-outline" (click)="contactTeacher(teacher)">
                ğŸ“§ Contacter
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeChildDetail()">
        Fermer
      </button>
    </div>
  </div>
</div>