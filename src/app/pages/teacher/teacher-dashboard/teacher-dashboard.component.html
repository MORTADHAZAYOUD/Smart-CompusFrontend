<div class="dashboard-container" *ngIf="!isLoading">
  <!-- Welcome Section -->
  <div class="welcome-section">
    <h1 class="welcome-title">Welcome Back!</h1>
    <p class="welcome-subtitle">Here's what's happening in your classes today</p>
  </div>

  <!-- Statistics Cards -->
  <div class="stats-grid">
    <mat-card class="stat-card" [style.border-left-color]="getStatColor('sessions')">
      <mat-card-content>
        <div class="stat-content">
          <div class="stat-icon" [style.color]="getStatColor('sessions')">
            <mat-icon>{{ getStatIcon('sessions') }}</mat-icon>
          </div>
          <div class="stat-details">
            <span class="stat-value">{{ stats.totalSessions }}</span>
            <span class="stat-label">Total Sessions</span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card" [style.border-left-color]="getStatColor('students')">
      <mat-card-content>
        <div class="stat-content">
          <div class="stat-icon" [style.color]="getStatColor('students')">
            <mat-icon>{{ getStatIcon('students') }}</mat-icon>
          </div>
          <div class="stat-details">
            <span class="stat-value">{{ stats.totalStudents }}</span>
            <span class="stat-label">Students</span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card" [style.border-left-color]="getStatColor('attendance')">
      <mat-card-content>
        <div class="stat-content">
          <div class="stat-icon" [style.color]="getStatColor('attendance')">
            <mat-icon>{{ getStatIcon('attendance') }}</mat-icon>
          </div>
          <div class="stat-details">
            <span class="stat-value">{{ stats.averageAttendance }}%</span>
            <span class="stat-label">Avg Attendance</span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card" [style.border-left-color]="getStatColor('grades')">
      <mat-card-content>
        <div class="stat-content">
          <div class="stat-icon" [style.color]="getStatColor('grades')">
            <mat-icon>{{ getStatIcon('grades') }}</mat-icon>
          </div>
          <div class="stat-details">
            <span class="stat-value">{{ stats.averageGrades }}/20</span>
            <span class="stat-label">Avg Grade</span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card" [style.border-left-color]="getStatColor('messages')">
      <mat-card-content>
        <div class="stat-content">
          <div class="stat-icon" [style.color]="getStatColor('messages')">
            <mat-icon>{{ getStatIcon('messages') }}</mat-icon>
          </div>
          <div class="stat-details">
            <span class="stat-value">{{ stats.unreadMessages }}</span>
            <span class="stat-label">New Messages</span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card" [style.border-left-color]="getStatColor('upcoming')">
      <mat-card-content>
        <div class="stat-content">
          <div class="stat-icon" [style.color]="getStatColor('upcoming')">
            <mat-icon>{{ getStatIcon('upcoming') }}</mat-icon>
          </div>
          <div class="stat-details">
            <span class="stat-value">{{ stats.upcomingSessions }}</span>
            <span class="stat-label">Upcoming Sessions</span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Charts Section -->
  <div class="charts-section">
    <div class="charts-grid">
      <!-- Attendance Chart -->
      <mat-card class="chart-card">
        <mat-card-header>
          <mat-card-title>Class Attendance</mat-card-title>
          <mat-card-subtitle>Attendance rates by class</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <ngx-charts-bar-vertical
            [results]="attendanceChartData"
            [scheme]="colorScheme"
            [view]="attendanceChartOptions.view"
            [showXAxis]="attendanceChartOptions.showXAxis"
            [showYAxis]="attendanceChartOptions.showYAxis"
            [gradient]="attendanceChartOptions.gradient"
            [showLegend]="attendanceChartOptions.showLegend"
            [showXAxisLabel]="attendanceChartOptions.showXAxisLabel"
            [showYAxisLabel]="attendanceChartOptions.showYAxisLabel"
            [xAxisLabel]="attendanceChartOptions.xAxisLabel"
            [yAxisLabel]="attendanceChartOptions.yAxisLabel"
            (select)="onChartSelect($event)">
          </ngx-charts-bar-vertical>
        </mat-card-content>
      </mat-card>

      <!-- Grade Distribution Chart -->
      <mat-card class="chart-card">
        <mat-card-header>
          <mat-card-title>Grade Distribution</mat-card-title>
          <mat-card-subtitle>Student performance overview</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <ngx-charts-pie-chart
            [results]="gradeDistributionData"
            [scheme]="colorScheme"
            [view]="gradeChartOptions.view"
            [gradient]="gradeChartOptions.gradient"
            [showLegend]="gradeChartOptions.showLegend"
            [showLabels]="gradeChartOptions.showLabels"
            [isDoughnut]="gradeChartOptions.isDoughnut"
            (select)="onChartSelect($event)">
          </ngx-charts-pie-chart>
        </mat-card-content>
      </mat-card>

      <!-- Weekly Sessions Chart -->
      <mat-card class="chart-card">
        <mat-card-header>
          <mat-card-title>Weekly Sessions</mat-card-title>
          <mat-card-subtitle>Sessions scheduled this week</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <ngx-charts-bar-vertical
            [results]="weeklySessionsData"
            [scheme]="colorScheme"
            [view]="[350, 200]"
            [showXAxis]="true"
            [showYAxis]="true"
            [gradient]="false"
            [showLegend]="false"
            [showXAxisLabel]="true"
            [showYAxisLabel]="true"
            [xAxisLabel]="'Days'"
            [yAxisLabel]="'Sessions'"
            (select)="onChartSelect($event)">
          </ngx-charts-bar-vertical>
        </mat-card-content>
      </mat-card>
    </div>
  </div>

  <!-- Activity Section -->
  <div class="activity-section">
    <div class="activity-grid">
      <!-- Upcoming Sessions -->
      <mat-card class="activity-card">
        <mat-card-header>
          <mat-card-title>Upcoming Sessions</mat-card-title>
          <mat-card-subtitle>Next 5 scheduled sessions</mat-card-subtitle>
          <button mat-icon-button (click)="navigateToSessions()" class="header-action">
            <mat-icon>arrow_forward</mat-icon>
          </button>
        </mat-card-header>
        <mat-card-content>
          <div class="session-list" *ngIf="upcomingSessions.length > 0; else noSessions">
            <div class="session-item" *ngFor="let session of upcomingSessions">
              <div class="session-icon">
                <mat-icon>{{ getSessionTypeIcon(session.type) }}</mat-icon>
              </div>
              <div class="session-details">
                <span class="session-title">{{ session.title }}</span>
                <span class="session-info">{{ session.class }} â€¢ {{ formatDate(session.date) }}</span>
                <span class="session-type">{{ session.type | titlecase }}</span>
              </div>
              <div class="session-time">
                {{ session.startTime }} - {{ session.endTime }}
              </div>
            </div>
          </div>
          <ng-template #noSessions>
            <div class="empty-state">
              <mat-icon>event_available</mat-icon>
              <span>No upcoming sessions</span>
            </div>
          </ng-template>
        </mat-card-content>
      </mat-card>

      <!-- Recent Notifications -->
      <mat-card class="activity-card">
        <mat-card-header>
          <mat-card-title>Recent Notifications</mat-card-title>
          <mat-card-subtitle>Latest updates and alerts</mat-card-subtitle>
          <button mat-icon-button (click)="navigateToNotifications()" class="header-action">
            <mat-icon>arrow_forward</mat-icon>
          </button>
        </mat-card-header>
        <mat-card-content>
          <div class="notification-list" *ngIf="recentNotifications.length > 0; else noNotifications">
            <div class="notification-item" *ngFor="let notification of recentNotifications">
              <div class="notification-icon" [class]="'priority-' + notification.priority">
                <mat-icon>{{ getNotificationIcon(notification.type) }}</mat-icon>
              </div>
              <div class="notification-details">
                <span class="notification-title">{{ notification.title }}</span>
                <span class="notification-message">{{ notification.message }}</span>
                <span class="notification-time">{{ formatDate(notification.timestamp) }}</span>
              </div>
            </div>
          </div>
          <ng-template #noNotifications>
            <div class="empty-state">
              <mat-icon>notifications_off</mat-icon>
              <span>No new notifications</span>
            </div>
          </ng-template>
        </mat-card-content>
      </mat-card>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="quick-actions">
    <mat-card class="actions-card">
      <mat-card-header>
        <mat-card-title>Quick Actions</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="actions-grid">
          <button mat-raised-button color="primary" (click)="navigateToSessions()">
            <mat-icon>add</mat-icon>
            Create Session
          </button>
          <button mat-raised-button color="accent" (click)="navigateToStudents()">
            <mat-icon>people</mat-icon>
            View Students
          </button>
          <button mat-raised-button (click)="navigateToMessages()">
            <mat-icon>message</mat-icon>
            Send Message
          </button>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>

<!-- Loading State -->
<div class="loading-container" *ngIf="isLoading">
  <mat-spinner diameter="50"></mat-spinner>
  <p>Loading dashboard...</p>
</div>